<!---------------------------------------------------------------------------------
Copyright: (c) BLS OPS LLC.
This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, version 3.
This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU General Public License for more details.
You should have received a copy of the GNU General Public License
along with this program. If not, see <https://www.gnu.org/licenses/>.
--------------------------------------------------------------------------------->
## [-] REFERENCES

1. https://www.splunk.com/en_us/blog/tips-and-tricks/metadata-metalore.html
2. https://www.splunk.com/en_us/blog/security/i-need-to-do-some-hunting-stat.html


## [-] NOTES

- The firstTime field is the timestamp for the first time that the indexer saw an event from this host.
- The lastTime field is the timestamp for the last time that the indexer saw an event from this host.
- The recentTime field is the indextime for the most recent time that the index saw an event from this host. In other words, this is the time of the last update.


## [-] USE CASES

__============ ALL HOSTS SENDING DATA TO SPLUNK ============__

__PROBLEM STATEMENT__ - View HOSTS that are sending data through to Splunk

__APPROACH__ 

        | metadata type=hosts index=botsv2

__STEPS EXPLAINED__ 

1. metadata - This will display data for hosts that have generated events in the botv2 index

__============ HOSTS w/ NO EVENTS IN LAST 24 HOURS ============__

__PROBLEM STATEMENT__ - Show HOSTS that have not checked in during the last 24 hours

__APPROACH__ 

        | metadata type=hosts index=main
        | eval "Last Seen" = now()-recentTime
        | search "Last Seen" > 86400
        | rename totalCount AS Count, firstTime AS "First Event",  lastTime AS "Last Event", recentTime AS "Last Update"
        | fieldformat "First Event"=strftime('First Event',"%c")
        | fieldformat "Last Event"=strftime('Last Event', "%c")
        | fieldformat "Last Update"=strftime('Last Update', "%c")
        | eval "Minutes Behind"= round('Last Seen'/60, 2)
        | eval "Hours Behind"= round('Last Seen'/3600, 2)
        | table host, "First Event" "Last Event" "Last Update" "Hours Behind" "Minutes Behind"
        | sort - “Minutes Behind”

__STEPS EXPLAINED__ 

1. metadata - This will display data for hosts that have generated events in the botv2 index
2. eval - For each host calculate the last time it generated an event. This is based on the table of values that is generated by metadata. Display this value as part of the table
3. search - Look for hosts where the value for “Last Seen” exceeds a specific value
4. rename - Rename table fields
5. fieldformat - Reformat the Unix epochtimes
6. eval - calculate minutes behind
7. eval - caluclate hours behind
8. table - display values
9. sort - Look for those hosts that are furthest behind


## [-] TAGS

\#metadata #eval #search #rename #fieldformat #table #sort 
